import{b as w}from"./chunk-XSWNUNXN.js";import{b as g,e as y}from"./chunk-DAQI4YGE.js";import{Fa as a,Gc as l,ea as f,i as n,ja as d}from"./chunk-IVPYXZHS.js";function S(r){return n(this,arguments,function*(s,_={},e=t=>console.log(t)){try{let t=yield fetch(s,_);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);if(!t.body)throw new Error("ReadableStream not supported");let c=t.body.getReader(),i=new TextDecoder("utf-8"),o="",h=!1;for(;!h;){let{done:m,value:b}=yield c.read();if(h=m,m){if(o.trim())try{console.log("Final chunk:",o)}catch(p){console.error("Error parsing final chunk:",p)}continue}o+=i.decode(b,{stream:!0});let u;for(;(u=o.indexOf("}"))>=0;){let p=o.substring(0,u+1);o=o.substring(u+1),e(p)}}}catch(t){console.error("Fetch error:",t)}})}var q=(()=>{class s{_settings=d(y);_file=d(w);headers=l(()=>{let e=new Headers(this._settings.headers());return e.append("Content-Type","application/json"),e});projectId=this._settings.projectId;endpoint=l(()=>this._settings.gatewayURL()+g);_resultBuffer=a("");searchResults=a([]);info=a("Search your project...");status=a("");properties=[{label:"Keyword",iri:"qcy:tag"},{label:"Summary",iri:"qcy:textSummary"},{label:"Value",iri:"qcy:value"}];executeSearch(e){return n(this,null,function*(){this.status.set("Executing search..."),this._resultBuffer.set("");let r={method:"POST",headers:this.headers(),body:JSON.stringify({projectId:this.projectId(),question:e.searchTerm,doRerank:e.inDepthMode,useGraph:!0,useVector:e.inDepthMode,limit:25})},t=i=>{this._processChunk(i)};yield S(this.endpoint(),r,t);let c=JSON.parse(this._resultBuffer());this.searchResults.update(()=>c.results.map(i=>this._formatResponse(i)))})}_processChunk(e){if(e.includes('"message"')){let r=JSON.parse(e);this.status.set(r.message)}else this._resultBuffer.update(r=>r+=e)}_formatResponse(e){let r=e.name.split(".").pop(),t=e.id.includes("?page=")?e.id.split("?page=")[1]:void 0;return{id:e.id,name:e.name.split("/").pop()??e.name,keywords:e.tags,summary:e.summary,mime:e.mime,size:parseInt(e.size),page:t,docURL:()=>n(this,null,function*(){return yield this._file.getDownloadURL("raw",`${this.projectId()}/${e.context}.${r}`)})}}static \u0275fac=function(r){return new(r||s)};static \u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{q as a};
