import{a as z}from"./chunk-3OAOPLDM.js";import{K as L,L as S,M as l}from"./chunk-PJ7HGDON.js";import{Bb as P,Ca as v,Cb as w,Eb as x,Fa as M,Gc as C,Hc as X,Jb as f,Kb as F,Lb as T,Mb as k,Nb as c,Ob as u,Pb as B,Rb as h,Zb as y,_b as r,ab as s,fc as D,hc as V,i as m,mb as b,oa as p,pa as _,sb as I,xb as g}from"./chunk-IVPYXZHS.js";var Y=()=>[l];function A(t,a){if(t&1){let e=h();c(0,"cue-passive-mode",4),y("activate",function(){p(e);let i=r(2);return _(i.loadDeferred=!0)}),u()}}function O(t,a){if(t&1){let e=h();c(0,"cue-map",5),y("hoveredFeature",function(i){p(e);let o=r(2);return _(o.setHovered(i))}),u()}if(t&2){let e=r(2);x("center",e.lngLat)("zoom",e.zoom)("cluster",!1)("featureCollection",e.featureCollection())("mapboxToken",e.mapboxToken())}}function E(t,a){if(t&1&&(g(0,A,1,0,"cue-passive-mode",3)(1,O,1,5),P(2,1,Y)),t&2){let e=r();f(e.loadDeferred?-1:0),s(2),w(e.loadDeferred)}}function R(t,a){if(t&1){let e=h();c(0,"cue-map",5),y("hoveredFeature",function(i){p(e);let o=r();return _(o.setHovered(i))}),u()}if(t&2){let e=r();x("center",e.lngLat)("zoom",e.zoom)("cluster",!1)("featureCollection",e.featureCollection())("mapboxToken",e.mapboxToken())}}function q(t,a){if(t&1&&B(0,"cue-key-val",6),t&2){let e=a.$implicit;x("key",e.key)("val",e.val)}}function H(t,a){if(t&1&&(c(0,"div",2)(1,"cue-key-val-list"),T(2,q,1,2,"cue-key-val",6,F),u()()),t&2){let e=r();s(2),k(e.featureProperties())}}function K(t){return m(this,null,function*(){return new Promise(a=>{let e=1/0,n=1/0,i=-1/0,o=-1/0;for(let d of t)e=Math.min(e,d[0]),n=Math.min(n,d[1]),i=Math.max(i,d[0]),o=Math.max(o,d[1]);a([e,n,i,o])})})}function Q(t,a=!0){return m(this,null,function*(){let e={type:"FeatureCollection",features:t};if(a){let n=[];t.forEach(i=>{i.geometry.coordinates!==void 0&&n.push(i.geometry.coordinates)}),e.bbox=yield K(n)}return e})}var G=(()=>{class t{data=v();startPassive=v(!0);loadDeferred=!1;features=C(()=>this.data()?.features??[]);featureProperties=C(()=>{let e=this.hoveredFeature()?.properties;return!e||e===void 0?[]:Object.keys(e).map(n=>({key:n,val:e[n]}))});mapboxToken=C(()=>this.data()?.mapboxToken??"");featureCollection=M(void 0);mapbox=b(l);lngLat=[8.5,47];zoom=1;hoveredFeature=M(void 0);plotFeatures=X(()=>m(this,null,function*(){let e=this.features();if(!e.length){this.featureCollection.set(void 0);return}let n=yield Q(e);this.featureCollection.set(n)}));setHovered(e){e===void 0?this.hoveredFeature.set(void 0):this.hoveredFeature.set(e.feature)}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=I({type:t,selectors:[["app-map"]],contentQueries:function(n,i,o){n&1&&D(o,i.mapbox,l,4),n&2&&V()},inputs:{data:[1,"data"],startPassive:[1,"startPassive"]},decls:4,vars:3,consts:[[1,"container"],[3,"center","zoom","cluster","featureCollection","mapboxToken"],[1,"right-pane","frosted"],["icon","map","label","Load map"],["icon","map","label","Load map",3,"activate"],[3,"hoveredFeature","center","zoom","cluster","featureCollection","mapboxToken"],["size","m",3,"key","val"]],template:function(n,i){if(n&1&&(c(0,"div",0),g(1,E,4,2)(2,R,1,5,"cue-map",1)(3,H,4,0,"div",2),u()),n&2){let o;s(),f(i.startPassive()?1:-1),s(),f(i.startPassive()?-1:2),s(),f((o=i.hoveredFeature())?3:-1,o)}},dependencies:[l,S,L,z],styles:[".container[_ngcontent-%COMP%]{position:relative;height:200px;width:100%}.right-pane[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;pointer-events:none;max-width:50%;max-height:70%;overflow-y:auto;z-index:10;border-top-left-radius:.5rem}.frosted[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);box-shadow:var(--frosted-shadow);padding:.5rem}"]})}return t})();export{G as InChatMap};
